/* eslint-env jest */

const Url = require('url')
const Waylay = require('../../index')
const moxios = require('moxios')

const waylay = new Waylay({ domain: 'my-domain.waylay.io' })
const host = 'accounts-api.waylay.io'

beforeEach(() => moxios.install(waylay.httpClient))
afterEach(() => moxios.uninstall())

test('list', done => {
  waylay.permissions.list()

  moxios.wait(() => {
    const { config, url } = moxios.requests.mostRecent()

    expect(config).toMatchObject({ method: 'get' })
    expect(Url.parse(url)).toMatchObject({
      protocol: 'https:',
      host: host,
      path: '/permissions'
    })

    done()
  })
})

test('get', done => {
  const permissionId = '2+2=4-1=3'

  waylay.permissions.get(permissionId)

  moxios.wait(() => {
    const { config, url } = moxios.requests.mostRecent()

    expect(config).toMatchObject({ method: 'get' })
    expect(Url.parse(url)).toMatchObject({
      protocol: 'https:',
      host: host,
      path: `/permissions/${permissionId}`
    })

    done()
  })
})

test('concepts', done => {
  waylay.permissions.concepts()

  moxios.wait(() => {
    const { config, url } = moxios.requests.mostRecent()

    expect(config).toMatchObject({ method: 'get' })
    expect(Url.parse(url)).toMatchObject({
      protocol: 'https:',
      host: host,
      path: '/permissions/concepts'
    })

    done()
  })
})
