/* eslint-env jest */

const Url = require('url')
const Waylay = require('../../index')
const moxios = require('moxios')

const waylay = new Waylay({ domain: 'my-domain.waylay.io' })
const host = 'accounts-api.waylay.io'

beforeEach(() => moxios.install(waylay.httpClient))
afterEach(() => moxios.uninstall())

test('branding using hostname', done => {
  const hostname = 'some-hostname'

  waylay.tenants.branding({ hostname })

  moxios.wait(() => {
    const { config, url } = moxios.requests.mostRecent()

    expect(config).toMatchObject({ method: 'get' })
    expect(Url.parse(url)).toMatchObject({
      protocol: 'https:',
      host: host,
      path: `/tenants/branding?hostname=${hostname}`
    })

    done()
  })
})

test('branding with empty param', done => {
  waylay.tenants.branding()

  moxios.wait(() => {
    const { config, url } = moxios.requests.mostRecent()

    expect(config).toMatchObject({ method: 'get' })
    expect(Url.parse(url)).toMatchObject({
      protocol: 'https:',
      host: host,
      path: '/tenants/branding'
    })

    done()
  })
})
