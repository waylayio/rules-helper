---
kind: pipeline
name: node 10

steps:
- name: test
  image: node:10
  commands:
  - yarn install --non-interactive --frozen-lockfile
  - yarn test

---
kind: pipeline
name: node 12

steps:
- name: test
  image: node:latest
  commands:
  - yarn install --non-interactive --frozen-lockfile
  - yarn test


---
kind: pipeline
name: latest

steps:
- name: test
  image: node:latest
  commands:
  - yarn install --non-interactive --frozen-lockfile
  - yarn test

---
kind: pipeline
name: Update Documentation

steps:
  - name: build
    image: node:12
    commands:
      - yarn install --production=false
      - yarn doc
    when:
      status: success

  - name: Publish Documentation
    image: plugins/s3-sync
    settings:
      bucket: waylay.internal-documentation
      region: eu-central-1
      source: docs-dist
      acl:
        "*": public-read
      access_key:
        from_secret: aws_access_key
      secret_key:
        from_secret: aws_secret_key
    when:
      event: ["push"]
      branch: ["master"]

depends_on:
  - "node 10"
  - "node 12"
  - "latest"

trigger:
  status: ["success"]
