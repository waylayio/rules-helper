'use strict'

const Resource = require('./resource')

const DEFAULT_BATCH_PATH = '/api/batch'

/**
 * @namespace BatchResource
 * @private
 */
class BatchResource extends Resource {
  constructor (options, client, batchOptions = {}) {
    super(options, client)

    const { path = DEFAULT_BATCH_PATH } = batchOptions
    this.batchPath = path
  }

  /**
   * Start a batch
   *
   * @param  {string} entity Waylay entity you want to target
   * @param  {string} action Action you want to perform
   * @param  {Object} query Query to select which entities should be targeted
   * @param  {Object} actionParameters Parameters specific for the action
   * @return {Promise<Batch>}
   */
  _batch (entity, action, query, actionParameters) {
    const data = {
      entity,
      action,
      query,
      actionParameters
    }

    return this._request({
      path: this.batchPath,
      method: 'POST',
      data
    })
  }

  /**
   * Fetch an operation
   *
   * @param  {string} id Operation id
   * @return {Promise<BatchOperation>}
   */
  operation (id) {
    return this._request({
      path: `${this.batchPath}/${id}`
    })
  }
}

module.exports = BatchResource
