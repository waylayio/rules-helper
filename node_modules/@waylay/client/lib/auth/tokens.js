const Resource = require('../resource')

/**
 * @private
 * @namespace Tokens
 */
class Tokens extends Resource {
  constructor (options, client) {
    super(options, client)
    this.refreshCallback = options.onTokenRefresh
  }

  refresh () {
    const refreshToken = this._client._refreshToken

    const config = {
      method: 'post',
      path: '/tokens',
      params: { grant_type: 'refresh_token' },
      data: { token: refreshToken }
    }

    return this._request(config).then((tokens) => {
      this.refreshCallback && this.refreshCallback(null, tokens)
      return tokens
    }).catch(err => {
      this.refreshCallback && this.refreshCallback(err)
      throw err
    })
  }
}

module.exports = Tokens
